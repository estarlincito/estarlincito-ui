"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const z=require("./Enum.js"),e=require("./Utility.js"),r=require("./Tokenizer.js");function C(c){return r.dealloc(y("",null,null,null,[""],c=r.alloc(c),0,[0],c))}function y(c,o,l,s,f,g,O,b,m){for(var u=0,v=0,i=O,M=0,k=0,E=0,n=1,q=1,p=1,t=0,h="",T=f,w=g,d=s,a=h;q;)switch(E=t,t=r.next()){case 40:if(E!=108&&e.charat(a,i-1)==58){e.indexof(a+=e.replace(r.delimit(t),"&","&\f"),"&\f",e.abs(u?b[u-1]:0))!=-1&&(p=-1);break}case 34:case 39:case 91:a+=r.delimit(t);break;case 9:case 10:case 13:case 32:a+=r.whitespace(E);break;case 92:a+=r.escaping(r.caret()-1,7);continue;case 47:switch(r.peek()){case 42:case 47:e.append(A(r.commenter(r.next(),r.caret()),o,l,m),m);break;default:a+="/"}break;case 123*n:b[u++]=e.strlen(a)*p;case 125*n:case 59:case 0:switch(t){case 0:case 125:q=0;case 59+v:p==-1&&(a=e.replace(a,/\f/g,"")),k>0&&e.strlen(a)-i&&e.append(k>32?x(a+";",s,l,i-1,m):x(e.replace(a," ","")+";",s,l,i-2,m),m);break;case 59:a+=";";default:if(e.append(d=S(a,o,l,u,v,f,b,h,T=[],w=[],i,g),g),t===123)if(v===0)y(a,o,d,d,T,g,i,b,w);else switch(M===99&&e.charat(a,3)===110?100:M){case 100:case 108:case 109:case 115:y(c,d,d,s&&e.append(S(c,d,d,0,0,f,b,h,f,T=[],i,w),w),f,w,i,b,s?T:w);break;default:y(a,d,d,d,[""],w,0,b,w)}}u=v=k=0,n=p=1,h=a="",i=O;break;case 58:i=1+e.strlen(a),k=E;default:if(n<1){if(t==123)--n;else if(t==125&&n++==0&&r.prev()==125)continue}switch(a+=e.from(t),t*n){case 38:p=v>0?1:(a+="\f",-1);break;case 44:b[u++]=(e.strlen(a)-1)*p,p=1;break;case 64:r.peek()===45&&(a+=r.delimit(r.next())),M=r.peek(),v=i=e.strlen(h=a+=r.identifier(r.caret())),t++;break;case 45:E===45&&e.strlen(a)==2&&(n=0)}}return g}function S(c,o,l,s,f,g,O,b,m,u,v,i){for(var M=f-1,k=f===0?g:[""],E=e.sizeof(k),n=0,q=0,p=0;n<s;++n)for(var t=0,h=e.substr(c,M+1,M=e.abs(q=O[n])),T=c;t<E;++t)(T=e.trim(q>0?k[t]+" "+h:e.replace(h,/&\f/g,k[t])))&&(m[p++]=T);return r.node(c,o,l,f===0?z.RULESET:b,m,u,v,i)}function A(c,o,l,s){return r.node(c,o,l,z.COMMENT,e.from(r.char()),e.substr(c,2,-2),0,s)}function x(c,o,l,s,f){return r.node(c,o,l,z.DECLARATION,e.substr(c,0,s),e.substr(c,s+1,-1),s,f)}exports.comment=A;exports.compile=C;exports.declaration=x;exports.parse=y;exports.ruleset=S;
